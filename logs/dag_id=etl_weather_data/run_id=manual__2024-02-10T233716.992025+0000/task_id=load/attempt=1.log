[2024-02-10T23:37:35.519+0000] {taskinstance.py:1957} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: etl_weather_data.load manual__2024-02-10T23:37:16.992025+00:00 [queued]>
[2024-02-10T23:37:35.534+0000] {taskinstance.py:1957} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: etl_weather_data.load manual__2024-02-10T23:37:16.992025+00:00 [queued]>
[2024-02-10T23:37:35.535+0000] {taskinstance.py:2171} INFO - Starting attempt 1 of 2
[2024-02-10T23:37:35.561+0000] {taskinstance.py:2192} INFO - Executing <Task(PythonOperator): load> on 2024-02-10 23:37:16.992025+00:00
[2024-02-10T23:37:35.568+0000] {standard_task_runner.py:60} INFO - Started process 85 to run task
[2024-02-10T23:37:35.574+0000] {standard_task_runner.py:87} INFO - Running: ['***', 'tasks', 'run', 'etl_weather_data', 'load', 'manual__2024-02-10T23:37:16.992025+00:00', '--job-id', '37', '--raw', '--subdir', 'DAGS_FOLDER/etl_dag.py', '--cfg-path', '/tmp/tmp981ajre0']
[2024-02-10T23:37:35.580+0000] {standard_task_runner.py:88} INFO - Job 37: Subtask load
[2024-02-10T23:37:35.665+0000] {task_command.py:423} INFO - Running <TaskInstance: etl_weather_data.load manual__2024-02-10T23:37:16.992025+00:00 [running]> on host 3ebc09df1e7c
[2024-02-10T23:37:36.154+0000] {taskinstance.py:2481} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='Lucas Andrini' AIRFLOW_CTX_DAG_ID='etl_weather_data' AIRFLOW_CTX_TASK_ID='load' AIRFLOW_CTX_EXECUTION_DATE='2024-02-10T23:37:16.992025+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='manual__2024-02-10T23:37:16.992025+00:00'
[2024-02-10T23:37:36.175+0000] {etl_dag.py:158} INFO - Contenido de df_transformed:
     lon    lat    main      description   temp  feels_like  temp_min  temp_max  pressure  humidity  visibility  speed                         dt country                                          name
0 -58.38 -34.61   Clear        clear sky  28.94       32.24     26.88     29.80      1009        68       10000   2.06  2024-02-10 23:37:25+00:00      AR                                  Buenos Aires
1 -34.90 -56.18  Clouds  overcast clouds   2.49       -4.51      2.49      2.49       991        78       10000  16.83  2024-02-10 23:37:26+00:00      GS  South Georgia and the South Sandwich Islands
2  51.50  -0.12  Clouds  overcast clouds  27.41       30.79     27.41     27.41      1012        81       10000   7.78  2024-02-10 23:37:28+00:00     NaN                                           NaN
3  -3.10 -60.02  Clouds  overcast clouds   0.40       -6.58      0.40      0.40       967        98          60  10.24  2024-02-10 23:37:30+00:00     NaN                                           NaN
4  25.77 -80.19  Clouds  overcast clouds -33.91      -40.83    -33.91    -33.91      1018       100        1142   1.62  2024-02-10 23:37:31+00:00     NaN                                           NaN
5  18.46 -66.10  Clouds       few clouds   0.07       -5.57      0.07      0.07       984        87       10000   6.44  2024-02-10 23:37:32+00:00     NaN                                           NaN
[2024-02-10T23:37:54.250+0000] {warnings.py:109} WARNING - /home/***/.local/lib/python3.8/site-packages/redshift_connector/cursor.py:272: UserWarning: DB-API extension cursor.connection used
  self.execute(operation, parameters)

[2024-02-10T23:37:54.614+0000] {taskinstance.py:2699} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1890, in _execute_context
    self.dialect.do_executemany(
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 733, in do_executemany
    cursor.executemany(statement, parameters)
  File "/home/airflow/.local/lib/python3.8/site-packages/redshift_connector/cursor.py", line 272, in executemany
    self.execute(operation, parameters)
  File "/home/airflow/.local/lib/python3.8/site-packages/redshift_connector/cursor.py", line 248, in execute
    raise e
  File "/home/airflow/.local/lib/python3.8/site-packages/redshift_connector/cursor.py", line 241, in execute
    self._c.execute(self, operation, args)
  File "/home/airflow/.local/lib/python3.8/site-packages/redshift_connector/core.py", line 1959, in execute
    self.handle_messages(cursor)
  File "/home/airflow/.local/lib/python3.8/site-packages/redshift_connector/core.py", line 2166, in handle_messages
    raise self.error
redshift_connector.error.ProgrammingError: {'S': 'ERROR', 'C': 'XX000', 'M': 'Cannot insert a NULL value into column name', 'D': '\n  -----------------------------------------------\n  error:  Cannot insert a NULL value into column name\n  code:      8007\n  context:   query execution\n  query:     25898976\n  location:  column:15\n  process:   query0_122_25898976 [pid=21744]\n  -----------------------------------------------\n', 'F': '../src/sys/xen_execute.cpp', 'L': '12414', 'R': 'pg_throw'}

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/models/taskinstance.py", line 433, in _execute_task
    result = execute_callable(context=context, **execute_callable_kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 199, in execute
    return_value = self.execute_callable()
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 216, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
  File "/opt/airflow/dags/etl_dag.py", line 176, in load
    df_transformed.to_sql(nombre_tabla_redshift, engine, if_exists='append', index=False)
  File "/home/airflow/.local/lib/python3.8/site-packages/pandas/core/generic.py", line 2878, in to_sql
    return sql.to_sql(
  File "/home/airflow/.local/lib/python3.8/site-packages/pandas/io/sql.py", line 769, in to_sql
    return pandas_sql.to_sql(
  File "/home/airflow/.local/lib/python3.8/site-packages/pandas/io/sql.py", line 1920, in to_sql
    total_inserted = sql_engine.insert_records(
  File "/home/airflow/.local/lib/python3.8/site-packages/pandas/io/sql.py", line 1470, in insert_records
    raise err
  File "/home/airflow/.local/lib/python3.8/site-packages/pandas/io/sql.py", line 1461, in insert_records
    return table.insert(chunksize=chunksize, method=method)
  File "/home/airflow/.local/lib/python3.8/site-packages/pandas/io/sql.py", line 1023, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
  File "/home/airflow/.local/lib/python3.8/site-packages/pandas/io/sql.py", line 929, in _execute_insert
    result = conn.execute(self.table.insert(), data)
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1385, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 334, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1577, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1953, in _execute_context
    self._handle_dbapi_exception(
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 2134, in _handle_dbapi_exception
    util.raise_(
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 211, in raise_
    raise exception
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1890, in _execute_context
    self.dialect.do_executemany(
  File "/home/airflow/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 733, in do_executemany
    cursor.executemany(statement, parameters)
  File "/home/airflow/.local/lib/python3.8/site-packages/redshift_connector/cursor.py", line 272, in executemany
    self.execute(operation, parameters)
  File "/home/airflow/.local/lib/python3.8/site-packages/redshift_connector/cursor.py", line 248, in execute
    raise e
  File "/home/airflow/.local/lib/python3.8/site-packages/redshift_connector/cursor.py", line 241, in execute
    self._c.execute(self, operation, args)
  File "/home/airflow/.local/lib/python3.8/site-packages/redshift_connector/core.py", line 1959, in execute
    self.handle_messages(cursor)
  File "/home/airflow/.local/lib/python3.8/site-packages/redshift_connector/core.py", line 2166, in handle_messages
    raise self.error
sqlalchemy.exc.ProgrammingError: (redshift_connector.error.ProgrammingError) {'S': 'ERROR', 'C': 'XX000', 'M': 'Cannot insert a NULL value into column name', 'D': '\n  -----------------------------------------------\n  error:  Cannot insert a NULL value into column name\n  code:      8007\n  context:   query execution\n  query:     25898976\n  location:  column:15\n  process:   query0_122_25898976 [pid=21744]\n  -----------------------------------------------\n', 'F': '../src/sys/xen_execute.cpp', 'L': '12414', 'R': 'pg_throw'}
[SQL: INSERT INTO weather_cities (lon, lat, main, description, temp, feels_like, temp_min, temp_max, pressure, humidity, visibility, speed, dt, country, name) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: ((-58.38, -34.61, 'Clear', 'clear sky', 28.94, 32.24, 26.88, 29.8, 1009, 68, 10000, 2.06, '2024-02-10 23:37:25+00:00', 'AR', 'Buenos Aires'), (-34.9, -56.18, 'Clouds', 'overcast clouds', 2.49, -4.51, 2.49, 2.49, 991, 78, 10000, 16.83, '2024-02-10 23:37:26+00:00', 'GS', 'South Georgia and the South Sandwich Islands'), (51.5, -0.12, 'Clouds', 'overcast clouds', 27.41, 30.79, 27.41, 27.41, 1012, 81, 10000, 7.78, '2024-02-10 23:37:28+00:00', None, None), (-3.1, -60.02, 'Clouds', 'overcast clouds', 0.4, -6.58, 0.4, 0.4, 967, 98, 60, 10.24, '2024-02-10 23:37:30+00:00', None, None), (25.77, -80.19, 'Clouds', 'overcast clouds', -33.91, -40.83, -33.91, -33.91, 1018, 100, 1142, 1.62, '2024-02-10 23:37:31+00:00', None, None), (18.46, -66.1, 'Clouds', 'few clouds', 0.07, -5.57, 0.07, 0.07, 984, 87, 10000, 6.44, '2024-02-10 23:37:32+00:00', None, None))]
(Background on this error at: https://sqlalche.me/e/14/f405)
[2024-02-10T23:37:54.634+0000] {taskinstance.py:1138} INFO - Marking task as UP_FOR_RETRY. dag_id=etl_weather_data, task_id=load, execution_date=20240210T233716, start_date=20240210T233735, end_date=20240210T233754
[2024-02-10T23:37:54.661+0000] {standard_task_runner.py:107} ERROR - Failed to execute job 37 for task load ((redshift_connector.error.ProgrammingError) {'S': 'ERROR', 'C': 'XX000', 'M': 'Cannot insert a NULL value into column name', 'D': '\n  -----------------------------------------------\n  error:  Cannot insert a NULL value into column name\n  code:      8007\n  context:   query execution\n  query:     25898976\n  location:  column:15\n  process:   query0_122_25898976 [pid=21744]\n  -----------------------------------------------\n', 'F': '../src/sys/xen_execute.cpp', 'L': '12414', 'R': 'pg_throw'}
[SQL: INSERT INTO weather_cities (lon, lat, main, description, temp, feels_like, temp_min, temp_max, pressure, humidity, visibility, speed, dt, country, name) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)]
[parameters: ((-58.38, -34.61, 'Clear', 'clear sky', 28.94, 32.24, 26.88, 29.8, 1009, 68, 10000, 2.06, '2024-02-10 23:37:25+00:00', 'AR', 'Buenos Aires'), (-34.9, -56.18, 'Clouds', 'overcast clouds', 2.49, -4.51, 2.49, 2.49, 991, 78, 10000, 16.83, '2024-02-10 23:37:26+00:00', 'GS', 'South Georgia and the South Sandwich Islands'), (51.5, -0.12, 'Clouds', 'overcast clouds', 27.41, 30.79, 27.41, 27.41, 1012, 81, 10000, 7.78, '2024-02-10 23:37:28+00:00', None, None), (-3.1, -60.02, 'Clouds', 'overcast clouds', 0.4, -6.58, 0.4, 0.4, 967, 98, 60, 10.24, '2024-02-10 23:37:30+00:00', None, None), (25.77, -80.19, 'Clouds', 'overcast clouds', -33.91, -40.83, -33.91, -33.91, 1018, 100, 1142, 1.62, '2024-02-10 23:37:31+00:00', None, None), (18.46, -66.1, 'Clouds', 'few clouds', 0.07, -5.57, 0.07, 0.07, 984, 87, 10000, 6.44, '2024-02-10 23:37:32+00:00', None, None))]
(Background on this error at: https://sqlalche.me/e/14/f405); 85)
[2024-02-10T23:37:54.714+0000] {local_task_job_runner.py:234} INFO - Task exited with return code 1
[2024-02-10T23:37:54.863+0000] {taskinstance.py:3281} INFO - 0 downstream tasks scheduled from follow-on schedule check
